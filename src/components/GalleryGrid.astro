---
interface GalleryItem {
    src: string;
    alt: string;
    caption: string;
    category: string;
}

interface Props {
    images: GalleryItem[];
    categories?: string[];
}

const { images, categories = ["Semua", "Tim Olahraga", "Perusahaan/Korporat", "Komunitas", "Event"] } = Astro.props;
---

<!-- Category Filter -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
    <div class="flex flex-wrap justify-center gap-3" id="gallery-filter">
        {categories.map((category, index) => (
            <button 
                class={`gallery-filter-btn px-5 py-2 rounded-full font-medium text-sm transition-all duration-300 ${
                    index === 0 
                        ? 'bg-primary text-white shadow-lg shadow-primary/30' 
                        : 'bg-accent text-secondary hover:bg-primary/10'
                }`}
                data-gallery-category={category}
            >
                {category}
            </button>
        ))}
    </div>
</div>

<!-- Masonry Grid -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6" id="gallery-masonry">
        {images.map((image, index) => (
            <div 
                class="gallery-card break-inside-avoid rounded-[2rem] overflow-hidden shadow-lg cursor-pointer group relative"
                data-gallery-item-category={image.category}
                data-index={index}
            >
                <img 
                    src={image.src} 
                    alt={image.alt}
                    class="w-full transition-transform duration-500 group-hover:scale-105"
                    loading="lazy"
                >
                <!-- Overlay -->
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6">
                    <div class="text-white transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                        <p class="font-medium text-sm leading-relaxed">{image.caption}</p>
                        <span class="text-xs text-primary mt-2 flex items-center gap-1">
                            <i data-lucide="zoom-in" class="w-3 h-3"></i>
                            Klik untuk memperbesar
                        </span>
                    </div>
                </div>
            </div>
        ))}
    </div>
</div>

<!-- Lightbox Modal -->
<div id="lightbox" class="fixed inset-0 z-[100] bg-black/95 hidden items-center justify-center p-4">
    <button id="lightbox-close" class="absolute top-6 right-6 text-white hover:text-primary transition-colors z-10">
        <i data-lucide="x" class="w-8 h-8"></i>
    </button>
    <button id="lightbox-prev" class="absolute left-6 top-1/2 -translate-y-1/2 text-white hover:text-primary transition-colors z-10">
        <i data-lucide="chevron-left" class="w-10 h-10"></i>
    </button>
    <button id="lightbox-next" class="absolute right-6 top-1/2 -translate-y-1/2 text-white hover:text-primary transition-colors z-10">
        <i data-lucide="chevron-right" class="w-10 h-10"></i>
    </button>
    <div class="max-w-5xl max-h-[90vh] relative">
        <img id="lightbox-image" src="" alt="" class="max-w-full max-h-[80vh] object-contain rounded-2xl shadow-2xl">
        <p id="lightbox-caption" class="text-white text-center mt-4 text-sm md:text-base"></p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Gallery Filter
        const filterBtns = document.querySelectorAll('.gallery-filter-btn');
        const galleryCards = document.querySelectorAll('.gallery-card');
        
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const category = btn.getAttribute('data-gallery-category');
                
                filterBtns.forEach(b => {
                    b.classList.remove('bg-primary', 'text-white', 'shadow-lg', 'shadow-primary/30');
                    b.classList.add('bg-accent', 'text-secondary');
                });
                btn.classList.remove('bg-accent', 'text-secondary');
                btn.classList.add('bg-primary', 'text-white', 'shadow-lg', 'shadow-primary/30');
                
                galleryCards.forEach(card => {
                    const cardCategory = card.getAttribute('data-gallery-item-category');
                    if (category === 'Semua' || cardCategory === category) {
                        (card as HTMLElement).style.display = 'block';
                    } else {
                        (card as HTMLElement).style.display = 'none';
                    }
                });
            });
        });
        
        // Lightbox
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.getElementById('lightbox-image') as HTMLImageElement;
        const lightboxCaption = document.getElementById('lightbox-caption');
        const closeBtn = document.getElementById('lightbox-close');
        const prevBtn = document.getElementById('lightbox-prev');
        const nextBtn = document.getElementById('lightbox-next');
        
        let currentIndex = 0;
        const images: {src: string, caption: string}[] = [];
        
        galleryCards.forEach((card, index) => {
            const img = card.querySelector('img');
            const caption = card.querySelector('p')?.textContent || '';
            if (img) {
                images.push({ src: img.src, caption });
            }
            
            card.addEventListener('click', () => {
                currentIndex = index;
                openLightbox();
            });
        });
        
        function openLightbox() {
            if (images[currentIndex]) {
                lightboxImage!.src = images[currentIndex].src;
                lightboxCaption!.textContent = images[currentIndex].caption;
                lightbox!.classList.remove('hidden');
                lightbox!.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeLightbox() {
            lightbox!.classList.add('hidden');
            lightbox!.classList.remove('flex');
            document.body.style.overflow = '';
        }
        
        function showPrev() {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : images.length - 1;
            openLightbox();
        }
        
        function showNext() {
            currentIndex = currentIndex < images.length - 1 ? currentIndex + 1 : 0;
            openLightbox();
        }
        
        closeBtn?.addEventListener('click', closeLightbox);
        prevBtn?.addEventListener('click', showPrev);
        nextBtn?.addEventListener('click', showNext);
        
        lightbox?.addEventListener('click', (e) => {
            if (e.target === lightbox) closeLightbox();
        });
        
        document.addEventListener('keydown', (e) => {
            if (!lightbox?.classList.contains('hidden')) {
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') showPrev();
                if (e.key === 'ArrowRight') showNext();
            }
        });
    });
</script>
